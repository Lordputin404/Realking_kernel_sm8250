name: Build RealKing Kernel (WebX Clang 19.1.5 + HyperOS Auto-Select)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout RK Kernel (root repo)
        uses: actions/checkout@v4
        with:
          ref: m-staging
          fetch-depth: 1
          submodules: false
          clean: true
          set-safe-directory: true

      - name: Prepare build_kernel.sh (Auto-select choices + non-interactive)
        run: |
          chmod +x build_kernel.sh
          sed -i 's|read -p "Enter the number of your choice: " clang_choice|clang_choice=${CLANG_CHOICE:-2}|g' build_kernel.sh
          sed -i 's|read -p "Enter the number of your choice: " build_choice|build_choice=${BUILD_CHOICE:-1}|g' build_kernel.sh
          echo "CI mode enabled â€” script will take env choices."

      - name: Run Kernel Build Script with Auto-Selected Options
        run: |
          export CLANG_CHOICE=2
          export BUILD_CHOICE=1
          ./build_kernel.sh
